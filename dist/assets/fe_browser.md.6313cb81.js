import{_ as n,o as a,c as l,S as p}from"./chunks/framework.6a244606.js";const D=JSON.parse('{"title":"浏览器","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"fe/browser.md","filePath":"fe/browser.md","lastUpdated":1686137360000}'),o={name:"fe/browser.md"};function e(t,s,c,r,y,i){return a(),l("div",null,s[0]||(s[0]=[p(`<h1 id="浏览器" tabindex="-1">浏览器 <a class="header-anchor" href="#浏览器" aria-label="Permalink to &quot;浏览器&quot;">​</a></h1><h2 id="浏览器渲染页面的过程" tabindex="-1">浏览器渲染页面的过程 <a class="header-anchor" href="#浏览器渲染页面的过程" aria-label="Permalink to &quot;浏览器渲染页面的过程&quot;">​</a></h2><h3 id="网络层" tabindex="-1">网络层 <a class="header-anchor" href="#网络层" aria-label="Permalink to &quot;网络层&quot;">​</a></h3><ol><li>构建请求</li><li>查找强缓存(Cache-Control)</li><li>DNS解析</li><li>建立TCP连接（三次握手、校验数据包）</li><li>发送HTTP请求（请求头、请求体、请求行）</li><li>网络响应</li></ol><h3 id="解析算法" tabindex="-1">解析算法 <a class="header-anchor" href="#解析算法" aria-label="Permalink to &quot;解析算法&quot;">​</a></h3><p>如果返回的是Content-Type:text/html就开始进入解析工作，其他的可能是下载</p><ol><li>构建dom树（从上到下解析HTML文档生成DOM节点树）（标记化）（建树算法）</li><li>样式计算（构建CSSOM树；加载解析样式生成CSSOM树）（格式化）（标准化）（计算规则：继承、层叠）</li><li>生成布局树（布局layout：根据渲染树将节点树的每一个节点布局在屏幕的正确位置）</li></ol><h3 id="渲染过程" tabindex="-1">渲染过程 <a class="header-anchor" href="#渲染过程" aria-label="Permalink to &quot;渲染过程&quot;">​</a></h3><p>绘制(painting)：遍历渲染树绘制所有节点，为每一个节点适用对应的样式，这一过程是通过UI后端模块完成。</p><ol><li>建图层树</li><li>生成绘制列表</li><li>生成图块和生成位图</li><li>显示器显示内容</li></ol><p>浏览器会将各层的信息发送GPU，GPU会将各层合成，最后显示在屏幕上。</p><p>最后断开连接：TCP四次挥手</p><h2 id="回流与重绘" tabindex="-1">回流与重绘 <a class="header-anchor" href="#回流与重绘" aria-label="Permalink to &quot;回流与重绘&quot;">​</a></h2><h3 id="回流-reflow" tabindex="-1">回流（reflow） <a class="header-anchor" href="#回流-reflow" aria-label="Permalink to &quot;回流（reflow）&quot;">​</a></h3><p>当我们对DOM的修改引发了DOM几何尺寸的变化（比如修改元素的宽、高或隐藏元素、添加或删除可见的DOM等）时，浏览器需要重新计算元素的几何属性（其他元素的几何属性和位置也会因此受到影响），然后再将计算的结果绘制出来，这个过程就称为回流（reflow）。</p><h3 id="重绘" tabindex="-1">重绘 <a class="header-anchor" href="#重绘" aria-label="Permalink to &quot;重绘&quot;">​</a></h3><p>当我们对DOM的修改导致了样式的变化、却并未影响其几何属性（比如修改了颜色或背景色）时，浏览器不需重新计算元素的几何属性、直接为该元素绘制新的样式（跳过了上图所示的回流环节），这个过程称为重绘（repaint）。</p><h3 id="避免方式" tabindex="-1">避免方式 <a class="header-anchor" href="#避免方式" aria-label="Permalink to &quot;避免方式&quot;">​</a></h3><p>回流必将引起重绘，而重绘不一定会引起回流</p><ul><li>避免频繁使用style，而是采用修改class的方式。</li><li>使用createDocumentFragment()方法，将需要多次操作的节点先添加到DocumentFragment中，然后再统一添加到document中。</li><li>对于resize、scroll等事件，我们可以使用防抖（debounce）来进行优化。</li><li>GPU加速（transform、opacity、filter、will-change）</li><li>分离读写操作（先读后写）</li><li>缓存需要修改的元素信息（减少DOM查询）</li><li>使用absolute或fixed定位，它们不在文档流中，因此不会引起回流。</li><li>使用visibility属性替换display:none，因为它只会引起重绘，不会引起回流。</li><li>避免使用table布局，可能很小的一个小改动会造成整个table的重新布局。</li><li>将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点，例如will-change、video、iframe等标签，浏览器会自动将该节点变为图层。</li></ul><h3 id="常见会导致回流的操作" tabindex="-1">常见会导致回流的操作 <a class="header-anchor" href="#常见会导致回流的操作" aria-label="Permalink to &quot;常见会导致回流的操作&quot;">​</a></h3><p>常见的几何属性有width、height、padding、margin、left、top、border等等。</p><p>最容易被忽略的操作：获取一些需要通过即时计算得到的属性值，比如：offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight时，浏览器为了获取这些值，也会进行回流操作。</p><p>当我们调用了getComputedStyle()、currentStyle()、getBoundingClientRect()等方法时，也会导致回流。(原理是一样的，都为求一个及时性和准确性)</p><h2 id="首屏加载优化" tabindex="-1">首屏加载优化 <a class="header-anchor" href="#首屏加载优化" aria-label="Permalink to &quot;首屏加载优化&quot;">​</a></h2><p>真的快：可以客观衡量的指标，像网页访问时间、交互响应时间、页面跳转时间。</p><p>觉得快：用户主观感知的性能，通过视觉引导等手段转移用户对等待的关注。</p><h3 id="体积优化" tabindex="-1">体积优化 <a class="header-anchor" href="#体积优化" aria-label="Permalink to &quot;体积优化&quot;">​</a></h3><h4 id="排查并移除冗余资源" tabindex="-1">排查并移除冗余资源 <a class="header-anchor" href="#排查并移除冗余资源" aria-label="Permalink to &quot;排查并移除冗余资源&quot;">​</a></h4><ul><li>移除项目模板冗余依赖</li><li>将public的静态资源移入assets。静态资源应该放在assets下，public只会单纯的复制到dist，应该放置不经webpack处理的文件，比如不兼容的webpack库，需要指定文件名的文件等。</li></ul><h4 id="构建时压缩图片" tabindex="-1">构建时压缩图片 <a class="header-anchor" href="#构建时压缩图片" aria-label="Permalink to &quot;构建时压缩图片&quot;">​</a></h4><p>image-webpack-loader</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">npm</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">image-webpack-loader</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">-D</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959;">image-webpack-loader</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">-D</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// vue.config.js</span></span>
<span class="line"><span style="color:#80A665;">chainWebpack</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isProd</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 图片压缩处理</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">imgRule</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">module</span><span style="color:#666666;">.</span><span style="color:#80A665;">rule</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">images</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">imgRule</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">/</span><span style="color:#E6CC77;">\\.</span><span style="color:#666666;">(</span><span style="color:#C4704F;">png</span><span style="color:#CB7676;">|</span><span style="color:#C4704F;">jpe</span><span style="color:#CB7676;">?</span><span style="color:#C4704F;">g</span><span style="color:#CB7676;">|</span><span style="color:#C4704F;">gif</span><span style="color:#CB7676;">|</span><span style="color:#C4704F;">webp</span><span style="color:#666666;">)(</span><span style="color:#E6CC77;">\\?</span><span style="color:#C99076;">.</span><span style="color:#CB7676;">*</span><span style="color:#666666;">)</span><span style="color:#CB7676;">?</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">image-webpack-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">loader</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">image-webpack-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">options</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">bypassOnDebug</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// vue.config.js</span></span>
<span class="line"><span style="color:#59873A;">chainWebpack</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isProd</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 图片压缩处理</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">imgRule</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">module</span><span style="color:#999999;">.</span><span style="color:#59873A;">rule</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">images</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">imgRule</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#999999;">(</span><span style="color:#AB5E3F;">png</span><span style="color:#AB5959;">|</span><span style="color:#AB5E3F;">jpe</span><span style="color:#AB5959;">?</span><span style="color:#AB5E3F;">g</span><span style="color:#AB5959;">|</span><span style="color:#AB5E3F;">gif</span><span style="color:#AB5959;">|</span><span style="color:#AB5E3F;">webp</span><span style="color:#999999;">)(</span><span style="color:#BDA437;">\\?</span><span style="color:#A65E2B;">.</span><span style="color:#AB5959;">*</span><span style="color:#999999;">)</span><span style="color:#AB5959;">?</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">image-webpack-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">loader</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">image-webpack-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">options</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#998418;">bypassOnDebug</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h4 id="使用webp格式图片" tabindex="-1">使用webp格式图片 <a class="header-anchor" href="#使用webp格式图片" aria-label="Permalink to &quot;使用webp格式图片&quot;">​</a></h4><ul><li>手动：建议使用官方webP-converter。</li><li>自动化生成，可以使用image-min-webp或其他webpack插件。</li></ul><h4 id="优化svg图标" tabindex="-1">优化svg图标 <a class="header-anchor" href="#优化svg图标" aria-label="Permalink to &quot;优化svg图标&quot;">​</a></h4><p>引入svg-sprite-loader，这是一个webpack插件，可以将多个svg打包成一个svg文件，减少http请求。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">npm</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">svg-sprite-loader</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">-D</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959;">svg-sprite-loader</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">-D</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// vue.config.js</span></span>
<span class="line"><span style="color:#80A665;">chainWebpack</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// SVG处理</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">module</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">rule</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">svg</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#BD976A;">exclude</span><span style="color:#666666;">.</span><span style="color:#80A665;">add</span><span style="color:#666666;">(</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">src/icons/svg</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">module</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">rule</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">icons</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">/</span><span style="color:#E6CC77;">\\.</span><span style="color:#C4704F;">svg</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#BD976A;">include</span><span style="color:#666666;">.</span><span style="color:#80A665;">add</span><span style="color:#666666;">(</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">src/icons/svg</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">svg-sprite-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">loader</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">svg-sprite-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">options</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">symbolId</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">icon-[name]</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// vue.config.js</span></span>
<span class="line"><span style="color:#59873A;">chainWebpack</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// SVG处理</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">module</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">rule</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">svg</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#B07D48;">exclude</span><span style="color:#999999;">.</span><span style="color:#59873A;">add</span><span style="color:#999999;">(</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">src/icons/svg</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">module</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">rule</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">icons</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">svg</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#B07D48;">include</span><span style="color:#999999;">.</span><span style="color:#59873A;">add</span><span style="color:#999999;">(</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">src/icons/svg</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">svg-sprite-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">loader</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">svg-sprite-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">options</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">symbolId</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">icon-[name]</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><p>创建src/icons/svg并将图标放进去，并通过webpack的require.context自动导入</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// src/icons/index.js</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">req</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">require</span><span style="color:#666666;">.</span><span style="color:#80A665;">context</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./svg</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span><span style="color:#C4704F;"> </span><span style="color:#C98A7D99;">/</span><span style="color:#E6CC77;">\\.</span><span style="color:#C4704F;">svg</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">requireAll</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">requireContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">requireContext</span><span style="color:#666666;">.</span><span style="color:#80A665;">keys</span><span style="color:#666666;">().</span><span style="color:#80A665;">map</span><span style="color:#666666;">(</span><span style="color:#BD976A;">requireContext</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#80A665;">requireAll</span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// main.js</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@/icons</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// src/icons/index.js</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">req</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">require</span><span style="color:#999999;">.</span><span style="color:#59873A;">context</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./svg</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span><span style="color:#AB5E3F;"> </span><span style="color:#B5695999;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">svg</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">requireAll</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">requireContext</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">requireContext</span><span style="color:#999999;">.</span><span style="color:#59873A;">keys</span><span style="color:#999999;">().</span><span style="color:#59873A;">map</span><span style="color:#999999;">(</span><span style="color:#B07D48;">requireContext</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#59873A;">requireAll</span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// main.js</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@/icons</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div><p>创建全局组件ca-svg</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// src/icons/index.js</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Vue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vue</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">CaSVG</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@/components/ca-svg</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#BD976A;">Vue</span><span style="color:#666666;">.</span><span style="color:#80A665;">component</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">ca-svg</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">CaSVG</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// src/components/ca-svg.vue</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">template</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">svg</span><span style="color:#DBD7CAEE;"> </span><span style="color:#FDAEB7;font-style:italic;">:class=&quot;svgClass&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">aria-hidden</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">true</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">v-on</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">$listeners</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#FDAEB7;font-style:italic;">:style=&quot;svgStyle&quot;&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#FDAEB7;font-style:italic;">&lt;use</span><span style="color:#DBD7CAEE;"> </span><span style="color:#FDAEB7;font-style:italic;">:xlink:href=&quot;iconName&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">/&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">svg</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#CB7676;">/</span><span style="color:#BD976A;">template</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">...</span></span>
<span class="line"><span style="color:#758575DD;">// name属性为必须字段，其他size或color可以自由定制</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// src/icons/index.js</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Vue</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vue</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">CaSVG</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@/components/ca-svg</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#B07D48;">Vue</span><span style="color:#999999;">.</span><span style="color:#59873A;">component</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">ca-svg</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">CaSVG</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// src/components/ca-svg.vue</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">template</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">svg</span><span style="color:#393A34;"> </span><span style="color:#B31D28;font-style:italic;">:class=&quot;svgClass&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">aria-hidden</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">true</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">v-on</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">$listeners</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B31D28;font-style:italic;">:style=&quot;svgStyle&quot;&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B31D28;font-style:italic;">&lt;use</span><span style="color:#393A34;"> </span><span style="color:#B31D28;font-style:italic;">:xlink:href=&quot;iconName&quot;</span><span style="color:#393A34;"> </span><span style="color:#999999;">/&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">svg</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#AB5959;">/</span><span style="color:#B07D48;">template</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">...</span></span>
<span class="line"><span style="color:#A0ADA0;">// name属性为必须字段，其他size或color可以自由定制</span></span></code></pre></div><p>SVG通常会有一些冗余信息导致影响体积，这里我们可以使用svgo-loader来进一步压缩</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">npm</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">svgo-loader</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">-D</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">npm</span><span style="color:#393A34;"> </span><span style="color:#B56959;">i</span><span style="color:#393A34;"> </span><span style="color:#B56959;">svgo-loader</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">-D</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// vue.config.js</span></span>
<span class="line"><span style="color:#758575DD;">// 接上面svg的配置</span></span>
<span class="line"><span style="color:#666666;">...</span></span>
<span class="line"><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">svgo-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">.</span><span style="color:#80A665;">loader</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">svgo-loader</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// vue.config.js</span></span>
<span class="line"><span style="color:#A0ADA0;">// 接上面svg的配置</span></span>
<span class="line"><span style="color:#999999;">...</span></span>
<span class="line"><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">svgo-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">.</span><span style="color:#59873A;">loader</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">svgo-loader</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">()</span></span></code></pre></div><h4 id="优化第三方体积-antd和图标" tabindex="-1">优化第三方体积(antd和图标) <a class="header-anchor" href="#优化第三方体积-antd和图标" aria-label="Permalink to &quot;优化第三方体积(antd和图标)&quot;">​</a></h4><p>antd的按需加载：</p><p>antd 默认支持基于 ES modules 的 tree shaking，直接引入 <code>import { Button } from &#39;antd&#39;;</code> 就会有按需加载的效果。</p><p>图标，重定向到本地来控制（2种方法）：</p><ol><li>使用webpack-ant-icon-loader，异步加载图标，减少打包体积</li><li>使用alias，将@ant-design/icons/lib/dist指向项目中的antd-icon.js，这样就可以在项目中直接引入antd的图标，而不需要额外安装@ant-design/icons</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// alias配置</span></span>
<span class="line"><span style="color:#80A665;">resolve</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">alias</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@ant-design/icons/lib/dist$</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./src/icons/antd-icon.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#758575DD;">// src/icons/antd-icon.js</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">default</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">as</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LoadingOutline</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@ant-design/icons/lib/outline/LoadingOutline</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// alias配置</span></span>
<span class="line"><span style="color:#59873A;">resolve</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">alias</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@ant-design/icons/lib/dist$</span><span style="color:#B5695999;">&#39;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./src/icons/antd-icon.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#A0ADA0;">// src/icons/antd-icon.js</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">default</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">as</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LoadingOutline</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@ant-design/icons/lib/outline/LoadingOutline</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div><h4 id="优化moment-moment-timezone体积" tabindex="-1">优化moment/moment-timezone体积 <a class="header-anchor" href="#优化moment-moment-timezone体积" aria-label="Permalink to &quot;优化moment/moment-timezone体积&quot;">​</a></h4><ul><li>不打包moment时区文件</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">plugins</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// Ignore all locale files of moment.js</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">webpack</span><span style="color:#666666;">.</span><span style="color:#80A665;">IgnorePlugin</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">/</span><span style="color:#4D9375;">^</span><span style="color:#E6CC77;">\\.\\/</span><span style="color:#C4704F;">locale</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">,</span><span style="color:#C4704F;"> </span><span style="color:#C98A7D99;">/</span><span style="color:#C4704F;">moment</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#666666;">],</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">plugins</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// Ignore all locale files of moment.js</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">webpack</span><span style="color:#999999;">.</span><span style="color:#59873A;">IgnorePlugin</span><span style="color:#999999;">(</span><span style="color:#B5695999;">/</span><span style="color:#1E754F;">^</span><span style="color:#BDA437;">\\.\\/</span><span style="color:#AB5E3F;">locale</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">,</span><span style="color:#AB5E3F;"> </span><span style="color:#B5695999;">/</span><span style="color:#AB5E3F;">moment</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#999999;">],</span></span></code></pre></div><ul><li>使用dayjs替代moment(注意其他第三方UI库是否使用moment)</li></ul><h4 id="优化core-js体积" tabindex="-1">优化core-js体积 <a class="header-anchor" href="#优化core-js体积" aria-label="Permalink to &quot;优化core-js体积&quot;">​</a></h4><p>core-js实际上就是浏览器的polyfill，它会根据你的代码中使用的ES6+特性，自动导入对应的polyfill，但是这样会导致打包体积过大，因为它会导入所有的polyfill，而我们实际上只需要导入项目中使用到的polyfill即可。</p><h5 id="调整-browserslistrc" tabindex="-1">调整.browserslistrc <a class="header-anchor" href="#调整-browserslistrc" aria-label="Permalink to &quot;调整.browserslistrc&quot;">​</a></h5><p>browserslistrc的作用：babel、autoprefixer、postcss、eslint、stylelint等工具都会读取这个配置文件，来确定需要兼容的目标浏览器。</p><p>指定项目需要兼容的版本，让babel和auto-prefix少做点兼容性工作，比如移动端不用兼容IE、iOS6.0以下等等</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// .browserslistrc</span></span>
<span class="line"><span style="color:#BD976A;">last</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">versions</span></span>
<span class="line"><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#CB7676;">%</span></span>
<span class="line"><span style="color:#BD976A;">iOS</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">7</span></span>
<span class="line"><span style="color:#BD976A;">Android</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">4.1</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// .browserslistrc</span></span>
<span class="line"><span style="color:#B07D48;">last</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">versions</span></span>
<span class="line"><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#AB5959;">%</span></span>
<span class="line"><span style="color:#B07D48;">iOS</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">7</span></span>
<span class="line"><span style="color:#B07D48;">Android</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">4.1</span></span></code></pre></div><h5 id="调整usebuiltins" tabindex="-1">调整useBuiltIns <a class="header-anchor" href="#调整usebuiltins" aria-label="Permalink to &quot;调整useBuiltIns&quot;">​</a></h5><p>项目中默认是entry，这样会导入所有的polyfill，我们可以改成usage，这样就只会导入项目中使用到的polyfill。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// babel.config.js</span></span>
<span class="line"><span style="color:#B8A965;">module</span><span style="color:#666666;">.</span><span style="color:#B8A965;">exports</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">presets</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@vue/cli-plugin-babel/preset</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@babel/preset-env</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">useBuiltIns</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">usage</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// entry，usage</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">corejs</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">3</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 指定core-js版本，目前babel7默认是core-js@2，babel8默认是core-js@3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">],</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// babel.config.js</span></span>
<span class="line"><span style="color:#998418;">module</span><span style="color:#999999;">.</span><span style="color:#998418;">exports</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">presets</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@vue/cli-plugin-babel/preset</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@babel/preset-env</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">useBuiltIns</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">usage</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// entry，usage</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">corejs</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">3</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 指定core-js版本，目前babel7默认是core-js@2，babel8默认是core-js@3</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">],</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h5 id="按需导入polyfill-推荐" tabindex="-1">按需导入polyfill（推荐） <a class="header-anchor" href="#按需导入polyfill-推荐" aria-label="Permalink to &quot;按需导入polyfill（推荐）&quot;">​</a></h5><p>使用动态polyfill，让服务器根据UA判断是否要返回polyfill。这样可以减少打包体积，同时也可以根据用户的浏览器版本，只返回必要的polyfill。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// main.js</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">core-js/stable</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">regenerator-runtime/runtime</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">polyfillUrl</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">https://polyfill.io/v3/polyfill.min.js?features=</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">polyfillFeatures</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Array.prototype.includes</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Promise</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Object.assign</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Object.entries</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Object.values</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">String.prototype.startsWith</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">String.prototype.endsWith</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">String.prototype.includes</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Symbol</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Symbol.asyncIterator</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Symbol.iterator</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Symbol.toStringTag</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#666666;">].</span><span style="color:#80A665;">join</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">%2C</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ua</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#BD976A;">navigator</span><span style="color:#666666;">.</span><span style="color:#BD976A;">userAgent</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isIE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ua</span><span style="color:#666666;">.</span><span style="color:#80A665;">indexOf</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">MSIE </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">-</span><span style="color:#4C9A91;">1</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ua</span><span style="color:#666666;">.</span><span style="color:#80A665;">indexOf</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">Trident/</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">-</span><span style="color:#4C9A91;">1</span></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isIE</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">script</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">createElement</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">script</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">script</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">polyfillUrl</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">polyfillFeatures</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">head</span><span style="color:#666666;">.</span><span style="color:#80A665;">appendChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">script</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// main.js</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">core-js/stable</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">regenerator-runtime/runtime</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">polyfillUrl</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">https://polyfill.io/v3/polyfill.min.js?features=</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">polyfillFeatures</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Array.prototype.includes</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Promise</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Object.assign</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Object.entries</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Object.values</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">String.prototype.startsWith</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">String.prototype.endsWith</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">String.prototype.includes</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Symbol</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Symbol.asyncIterator</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Symbol.iterator</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Symbol.toStringTag</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#999999;">].</span><span style="color:#59873A;">join</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">%2C</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ua</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#B07D48;">navigator</span><span style="color:#999999;">.</span><span style="color:#B07D48;">userAgent</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isIE</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ua</span><span style="color:#999999;">.</span><span style="color:#59873A;">indexOf</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">MSIE </span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#2F798A;">1</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ua</span><span style="color:#999999;">.</span><span style="color:#59873A;">indexOf</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Trident/</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#2F798A;">1</span></span>
<span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isIE</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">script</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">createElement</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">script</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">script</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">polyfillUrl</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">polyfillFeatures</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">head</span><span style="color:#999999;">.</span><span style="color:#59873A;">appendChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">script</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="传输优化" tabindex="-1">传输优化 <a class="header-anchor" href="#传输优化" aria-label="Permalink to &quot;传输优化&quot;">​</a></h3><h4 id="优化分包策略" tabindex="-1">优化分包策略 <a class="header-anchor" href="#优化分包策略" aria-label="Permalink to &quot;优化分包策略&quot;">​</a></h4><p>vue-cli3的默认优化是将所有npm依赖都打进chunk-vendor，但这种做法在依赖多的情况下导致chunk-vendor过大</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">optimization</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isProd</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">splitChunks</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">chunks</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">all</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">maxInitialRequests</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">Infinity</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 默认为3，调整为允许无限入口资源</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">minSize</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">20000</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 20K以下的依赖不做拆分</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">cacheGroups</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">vendors</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// 拆分依赖，避免单文件过大拖慢页面展示</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// 得益于HTTP2多路复用，不用太担心资源请求太多的问题</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">name</span><span style="color:#666666;">(</span><span style="color:#BD976A;">module</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// 拆包</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">packageName</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">module</span><span style="color:#666666;">.</span><span style="color:#BD976A;">context</span><span style="color:#666666;">.</span><span style="color:#80A665;">match</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">[</span><span style="color:#E6CC77;">\\\\</span><span style="color:#C99076;">/</span><span style="color:#666666;">]</span><span style="color:#C4704F;">node_modules</span><span style="color:#666666;">[</span><span style="color:#E6CC77;">\\\\</span><span style="color:#C99076;">/</span><span style="color:#666666;">](</span><span style="color:#C99076;">.</span><span style="color:#CB7676;">*?</span><span style="color:#666666;">)([</span><span style="color:#E6CC77;">\\\\</span><span style="color:#C99076;">/</span><span style="color:#666666;">]</span><span style="color:#CB7676;">|</span><span style="color:#4D9375;">$</span><span style="color:#666666;">)</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">)[</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// 进一步将Ant组件拆分出来,请根据情况来</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// const packageName = module.context.match(/[\\\\/]node_modules[\\\\/](?:ant-design-vue[\\\\/]es[\\\\/])?(.*?)([\\\\/]|$)/)[1]</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">\`</span><span style="color:#C98A7D;">npm.</span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">packageName</span><span style="color:#666666;">.</span><span style="color:#80A665;">replace</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#C98A7D;"> </span><span style="color:#C98A7D99;">&#39;&#39;</span><span style="color:#666666;">)</span><span style="color:#666666;">}</span><span style="color:#C98A7D99;">\`</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 部分服务器不允许URL带@</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">test</span><span style="color:#666666;">:</span><span style="color:#C4704F;"> </span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">[</span><span style="color:#E6CC77;">\\\\</span><span style="color:#C99076;">/</span><span style="color:#666666;">]</span><span style="color:#C4704F;">node_modules</span><span style="color:#666666;">[</span><span style="color:#E6CC77;">\\\\</span><span style="color:#C99076;">/</span><span style="color:#666666;">]</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">priority</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">-</span><span style="color:#4C9A91;">10</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">chunks</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">initial</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">runtimeChunk</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">entrypoint</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">\`</span><span style="color:#C98A7D;">runtime-</span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">entrypoint</span><span style="color:#666666;">.</span><span style="color:#C98A7D;">name</span><span style="color:#666666;">}</span><span style="color:#C98A7D99;">\`</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">optimization</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isProd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">splitChunks</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">chunks</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">all</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">maxInitialRequests</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">Infinity</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 默认为3，调整为允许无限入口资源</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">minSize</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">20000</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 20K以下的依赖不做拆分</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">cacheGroups</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">vendors</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// 拆分依赖，避免单文件过大拖慢页面展示</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// 得益于HTTP2多路复用，不用太担心资源请求太多的问题</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">name</span><span style="color:#999999;">(</span><span style="color:#B07D48;">module</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// 拆包</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">packageName</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#998418;">module</span><span style="color:#999999;">.</span><span style="color:#B07D48;">context</span><span style="color:#999999;">.</span><span style="color:#59873A;">match</span><span style="color:#999999;">(</span><span style="color:#B5695999;">/</span><span style="color:#999999;">[</span><span style="color:#BDA437;">\\\\</span><span style="color:#A65E2B;">/</span><span style="color:#999999;">]</span><span style="color:#AB5E3F;">node_modules</span><span style="color:#999999;">[</span><span style="color:#BDA437;">\\\\</span><span style="color:#A65E2B;">/</span><span style="color:#999999;">](</span><span style="color:#A65E2B;">.</span><span style="color:#AB5959;">*?</span><span style="color:#999999;">)([</span><span style="color:#BDA437;">\\\\</span><span style="color:#A65E2B;">/</span><span style="color:#999999;">]</span><span style="color:#AB5959;">|</span><span style="color:#1E754F;">$</span><span style="color:#999999;">)</span><span style="color:#B5695999;">/</span><span style="color:#999999;">)[</span><span style="color:#2F798A;">1</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// 进一步将Ant组件拆分出来,请根据情况来</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// const packageName = module.context.match(/[\\\\/]node_modules[\\\\/](?:ant-design-vue[\\\\/]es[\\\\/])?(.*?)([\\\\/]|$)/)[1]</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">\`</span><span style="color:#B56959;">npm.</span><span style="color:#999999;">\${</span><span style="color:#B56959;">packageName</span><span style="color:#999999;">.</span><span style="color:#59873A;">replace</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#B56959;"> </span><span style="color:#B5695999;">&#39;&#39;</span><span style="color:#999999;">)</span><span style="color:#999999;">}</span><span style="color:#B5695999;">\`</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 部分服务器不允许URL带@</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">test</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B5695999;">/</span><span style="color:#999999;">[</span><span style="color:#BDA437;">\\\\</span><span style="color:#A65E2B;">/</span><span style="color:#999999;">]</span><span style="color:#AB5E3F;">node_modules</span><span style="color:#999999;">[</span><span style="color:#BDA437;">\\\\</span><span style="color:#A65E2B;">/</span><span style="color:#999999;">]</span><span style="color:#B5695999;">/</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">priority</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#2F798A;">10</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">chunks</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">initial</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">runtimeChunk</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#59873A;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">entrypoint</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">\`</span><span style="color:#B56959;">runtime-</span><span style="color:#999999;">\${</span><span style="color:#B56959;">entrypoint</span><span style="color:#999999;">.</span><span style="color:#B56959;">name</span><span style="color:#999999;">}</span><span style="color:#B5695999;">\`</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>vue inspect &gt; output.js --mode production 可以查看最终配置 (结合实际调整)</p></div><h4 id="优化路由懒加载" tabindex="-1">优化路由懒加载 <a class="header-anchor" href="#优化路由懒加载" aria-label="Permalink to &quot;优化路由懒加载&quot;">​</a></h4><p>SPA中一个很重要的提速手段就是路由懒加载，当打开页面时才去加载对应文件，我们利用Vue的异步组件和webpack的代码分割（import()）就可以轻松实现懒加载了。</p><p>但当路由过多时，请合理地用webpack的魔法注释对路由进行分组，太多的chunk会影响构建时的速度</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">router</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">path</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">register</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">register</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">component</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">import</span><span style="color:#666666;">(</span><span style="color:#758575DD;">/* webpackChunkName: &quot;user&quot; */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">@/views/user/register</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#666666;">}]</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">router</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">path</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">register</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">register</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">component</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#59873A;">import</span><span style="color:#999999;">(</span><span style="color:#A0ADA0;">/* webpackChunkName: &quot;user&quot; */</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">@/views/user/register</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#999999;">}]</span></span></code></pre></div><h4 id="开启http2" tabindex="-1">开启HTTP2 <a class="header-anchor" href="#开启http2" aria-label="Permalink to &quot;开启HTTP2&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">//</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">nginx.conf</span></span>
<span class="line"><span style="color:#80A665;">listen</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">443</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">http2</span><span style="color:#666666;">;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">//</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx.conf</span></span>
<span class="line"><span style="color:#59873A;">listen</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">443</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http2</span><span style="color:#999999;">;</span></span></code></pre></div><h4 id="gzip压缩传输" tabindex="-1">GZIP压缩传输 <a class="header-anchor" href="#gzip压缩传输" aria-label="Permalink to &quot;GZIP压缩传输&quot;">​</a></h4><p>当响应头的 Content-Encoding指定了gzip时，浏览器则会进行对应解压</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">#开启和关闭gzip模式</span></span>
<span class="line"><span style="color:#80A665;">gzip</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">on</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">#gizp压缩起点，文件大于1k才进行压缩</span></span>
<span class="line"><span style="color:#80A665;">gzip_min_length</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#C98A7D;">k</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;"># gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间</span></span>
<span class="line"><span style="color:#80A665;">gzip_comp_level</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">6</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;"># 进行压缩的文件类型。</span></span>
<span class="line"><span style="color:#80A665;">gzip_types</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">text/plain</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">application/javascript</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">application/x-javascript</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">text/css</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">application/xml</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">text/javascript</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;"># nginx对于静态文件的处理模块，开启后会寻找以.gz结尾的文件，直接返回，不会占用cpu进行压缩，如果找不到则不进行压缩</span></span>
<span class="line"><span style="color:#80A665;">gzip_static</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">on</span></span>
<span class="line"><span style="color:#758575DD;"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span></span>
<span class="line"><span style="color:#80A665;">gzip_vary</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">on</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;"># 设置gzip压缩针对的HTTP协议版本</span></span>
<span class="line"><span style="color:#80A665;">gzip_http_version</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1.1</span><span style="color:#666666;">;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">#开启和关闭gzip模式</span></span>
<span class="line"><span style="color:#59873A;">gzip</span><span style="color:#393A34;"> </span><span style="color:#B56959;">on</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">#gizp压缩起点，文件大于1k才进行压缩</span></span>
<span class="line"><span style="color:#59873A;">gzip_min_length</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#B56959;">k</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;"># gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间</span></span>
<span class="line"><span style="color:#59873A;">gzip_comp_level</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">6</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;"># 进行压缩的文件类型。</span></span>
<span class="line"><span style="color:#59873A;">gzip_types</span><span style="color:#393A34;"> </span><span style="color:#B56959;">text/plain</span><span style="color:#393A34;"> </span><span style="color:#B56959;">application/javascript</span><span style="color:#393A34;"> </span><span style="color:#B56959;">application/x-javascript</span><span style="color:#393A34;"> </span><span style="color:#B56959;">text/css</span><span style="color:#393A34;"> </span><span style="color:#B56959;">application/xml</span><span style="color:#393A34;"> </span><span style="color:#B56959;">text/javascript</span><span style="color:#393A34;"> </span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;"># nginx对于静态文件的处理模块，开启后会寻找以.gz结尾的文件，直接返回，不会占用cpu进行压缩，如果找不到则不进行压缩</span></span>
<span class="line"><span style="color:#59873A;">gzip_static</span><span style="color:#393A34;"> </span><span style="color:#B56959;">on</span></span>
<span class="line"><span style="color:#A0ADA0;"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span></span>
<span class="line"><span style="color:#59873A;">gzip_vary</span><span style="color:#393A34;"> </span><span style="color:#B56959;">on</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;"># 设置gzip压缩针对的HTTP协议版本</span></span>
<span class="line"><span style="color:#59873A;">gzip_http_version</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1.1</span><span style="color:#999999;">;</span></span></code></pre></div><p>构建时生成gzip文件</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// vue.config.js</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">CompressionPlugin</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">compression-webpack-plugin</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#758575DD;">// gzip压缩处理</span></span>
<span class="line"><span style="color:#80A665;">chainWebpack</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#666666;">(</span><span style="color:#BD976A;">isProd</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#80A665;">plugin</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">compression-webpack-plugin</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">CompressionPlugin</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">test</span><span style="color:#666666;">:</span><span style="color:#C4704F;"> </span><span style="color:#C98A7D99;">/</span><span style="color:#E6CC77;">\\.</span><span style="color:#C4704F;">js</span><span style="color:#4D9375;">$</span><span style="color:#CB7676;">|</span><span style="color:#E6CC77;">\\.</span><span style="color:#C4704F;">html</span><span style="color:#4D9375;">$</span><span style="color:#CB7676;">|</span><span style="color:#E6CC77;">\\.</span><span style="color:#C4704F;">css</span><span style="color:#4D9375;">$</span><span style="color:#C98A7D99;">/</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 匹配文件名</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">threshold</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">10240</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 对超过10k的数据压缩</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">deleteOriginalAssets</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 不删除源文件</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// vue.config.js</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">CompressionPlugin</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">compression-webpack-plugin</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#A0ADA0;">// gzip压缩处理</span></span>
<span class="line"><span style="color:#59873A;">chainWebpack</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#999999;">(</span><span style="color:#B07D48;">isProd</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#59873A;">plugin</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">compression-webpack-plugin</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">CompressionPlugin</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">test</span><span style="color:#999999;">:</span><span style="color:#AB5E3F;"> </span><span style="color:#B5695999;">/</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">js</span><span style="color:#1E754F;">$</span><span style="color:#AB5959;">|</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">html</span><span style="color:#1E754F;">$</span><span style="color:#AB5959;">|</span><span style="color:#BDA437;">\\.</span><span style="color:#AB5E3F;">css</span><span style="color:#1E754F;">$</span><span style="color:#B5695999;">/</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 匹配文件名</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">threshold</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">10240</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 对超过10k的数据压缩</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">deleteOriginalAssets</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 不删除源文件</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}))</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>虽然上面配置后Nginx已经会在响应请求时进行压缩并返回Gzip了，但是压缩操作本身是会占用服务器的CPU和时间的，压缩等级越高开销越大，所以我们通常会一并上传gzip文件，让服务器直接返回压缩后文件</p><p>插件的默认压缩等级是9，最高级的压缩 图片文件不建议使用gzip压缩，效果较差</p></div><h4 id="prefetch、preload" tabindex="-1">prefetch、preload <a class="header-anchor" href="#prefetch、preload" aria-label="Permalink to &quot;prefetch、preload&quot;">​</a></h4><p><code>&lt;link&gt;</code>标签的rel属性的两个可选值。</p><ul><li>prefetch，预请求，是为了提示浏览器，用户未来的浏览有可能需要加载目标资源，所以浏览器有可能通过事先获取和缓存对应资源，优化用户体验。</li><li>preload，预加载，表示用户十分有可能需要在当前浏览中加载目标资源，所以浏览器必须预先获取和缓存对应资源。</li></ul><h5 id="场景" tabindex="-1">场景 <a class="header-anchor" href="#场景" aria-label="Permalink to &quot;场景&quot;">​</a></h5><p>首屏字体、大图加载，CSS中引入字体需要等CSS解析后才会加载，这之前浏览器会使用默认字体，当加载后会替换为自定义字体，导致字体样式闪动，而我们使用preload提前加载字体后这种情况就好很多了，大图也是如此</p><p>优惠券的背景图加载，同样CSS中url引用在DOM没挂载之前是不会加载图片的，进入卡包页/收银台时可以提前使用prefetch加载，这样用户在进行优惠券页就可以立马看到加载完成的图片了</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Vue-Cli3默认会使用preload-webpack-plugin对chunk资源做preload、prefetch处理，入口文件preload，路由chunk则是prefetch。</p><p>一般来说不需要做特别处理，如果判断不需要或者需要调整在vue.config.js中配置即可</p><p>移动端流量访问慎用</p></div><h4 id="托管至oss-cdn加速" tabindex="-1">托管至OSS+CDN加速 <a class="header-anchor" href="#托管至oss-cdn加速" aria-label="Permalink to &quot;托管至OSS+CDN加速&quot;">​</a></h4><p>当应对一些弱网地区时，OSS+CDN无疑是很强力的提速手段</p><h5 id="oss-对象存储" tabindex="-1">OSS，对象存储 <a class="header-anchor" href="#oss-对象存储" aria-label="Permalink to &quot;OSS，对象存储&quot;">​</a></h5><p>海量，安全，低成本，高可靠的云存储服务。可以通过简单的REST接口，在任何时间、任何地点上传和下载数据，也可以使用WEB页面对数据进行管理。</p><p>优点：</p><ul><li>稳定，服务可用性高，多重备份保障数据安全</li><li>安全，多层次安全防护，防DDoS</li><li>大规模，高性能，从容应对高并发</li></ul><p>其他服务：</p><ul><li>图片处理，支持压缩、裁剪、水印、格式转换等</li><li>传输加速，优化传输链路和协议策略实现高速传输</li></ul><h5 id="cdn-内容分发网络" tabindex="-1">CDN，内容分发网络 <a class="header-anchor" href="#cdn-内容分发网络" aria-label="Permalink to &quot;CDN，内容分发网络&quot;">​</a></h5><p>CDN加速原理是把提供的域名作为源站，将源内容缓存到边缘节点。当客户读取数据时，会从最适合的节点（一般来说就近获取）获取缓存文件，以提升下载速度。</p><h3 id="感知优化" tabindex="-1">感知优化 <a class="header-anchor" href="#感知优化" aria-label="Permalink to &quot;感知优化&quot;">​</a></h3><h4 id="白屏loading动画" tabindex="-1">白屏loading动画 <a class="header-anchor" href="#白屏loading动画" aria-label="Permalink to &quot;白屏loading动画&quot;">​</a></h4><p>首屏优化，在JS没解析执行前，让用户能看到Loading动画，减轻等待焦虑。通常会在index.html上写简单的CSS动画，直到Vue挂载后替换挂载节点的内容，但这种做法实测也会出现短暂的白屏，建议手动控制CSS动画关闭</p><h4 id="首屏骨架加载" tabindex="-1">首屏骨架加载 <a class="header-anchor" href="#首屏骨架加载" aria-label="Permalink to &quot;首屏骨架加载&quot;">​</a></h4><p>首屏优化，APP内常见的加载时各部分灰色色块。针对骨架屏页的自动化生成，业界已有不少解决方案。</p><h4 id="渐进加载图片" tabindex="-1">渐进加载图片 <a class="header-anchor" href="#渐进加载图片" aria-label="Permalink to &quot;渐进加载图片&quot;">​</a></h4><p>一般来说，图片加载有两种方式，一种是自上而下扫描，一种则是原图的模糊展示，然后逐渐/加载完清晰。前者在网速差的时候用户体验较差，后者的渐进/交错式加载则能减轻用户的等待焦虑，带来更好的体验</p><p>渐进/交错格式图片：浏览器本身支持这种图片的模糊到清晰的扫描加载方式，只需要将处理好资源即可</p><p>渐进加载图片：先加载小图，模糊化渲染，图片加载完成后替换为原图，最典型的例子就是Medium，模糊化可以用filter或者canvas处理</p><p>加载占位图： 先加载全局通用loading图或者用CSS填充色块，图片加载完成后替换为原图。简单粗暴，在弱网条件下很有用</p><h4 id="路由跳转loading动画" tabindex="-1">路由跳转loading动画 <a class="header-anchor" href="#路由跳转loading动画" aria-label="Permalink to &quot;路由跳转loading动画&quot;">​</a></h4><p>弱网优化手段，用了懒加载后用户如果在弱网条件下点击下一个页面在下个页面加载完成前页面内容不可用，用户会理解为卡顿。在VueRouter的路由守卫中处理即可</p><h4 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to &quot;其他&quot;">​</a></h4><p>首屏以外的一些场景优化，更多相关内容比如图片懒加载、组件懒加载等。</p><h2 id="小程序优化-上面的内容是基础" tabindex="-1">小程序优化（上面的内容是基础） <a class="header-anchor" href="#小程序优化-上面的内容是基础" aria-label="Permalink to &quot;小程序优化（上面的内容是基础）&quot;">​</a></h2><h3 id="小程序体积优化" tabindex="-1">小程序体积优化 <a class="header-anchor" href="#小程序体积优化" aria-label="Permalink to &quot;小程序体积优化&quot;">​</a></h3><ol><li>分包加载</li><li>部分页面h5化（交互通过jssdk或postMessage）</li></ol><h3 id="代码层面优化" tabindex="-1">代码层面优化 <a class="header-anchor" href="#代码层面优化" aria-label="Permalink to &quot;代码层面优化&quot;">​</a></h3><ol><li>setData合并及降频率</li><li>减少节点数量</li><li>setData之前diff、去掉不必要的事件绑定、去掉节点绑定、适当的组件颗粒度、事件总线代替组件数据绑定（逻辑层处理比线程通信更合理）、wx.onMemoryWarning内存告警（收集并优化）</li><li>onHide时回收定时器</li><li>避免频发事件中的重度内存操作(onPageScroll节流，避免cpu密集操作，尽量使用IntersectionObserver来替代SelectorQuery)</li><li>长列表优化</li></ol><h3 id="首屏体验优化" tabindex="-1">首屏体验优化 <a class="header-anchor" href="#首屏体验优化" aria-label="Permalink to &quot;首屏体验优化&quot;">​</a></h3><ol><li>首屏时长优化：本地缓存，根据用户属性和数据版本号对缓存隔离</li><li>数据预拉取：启动小程序时，小程序通过http到第三方获取数据，把响应数据存储在本地客户端</li><li>分屏渲染：分屏渲染是指在小程序启动时，将页面分成多个屏，每屏渲染一部分内容，当用户滑动页面时，再渲染下一屏内容</li><li>跳转时预拉取：在用户点击跳转前，提前拉取跳转页面的数据，跳转时直接使用（存在全局Promise中）</li><li>分包预下载：在进入某个页面时，下载分包数据</li></ol><h3 id="接口层面优化" tabindex="-1">接口层面优化 <a class="header-anchor" href="#接口层面优化" aria-label="Permalink to &quot;接口层面优化&quot;">​</a></h3><ol><li>非关键渲染数据延迟请求：拆分接口，主体模块一个接口，非主体模块一个接口</li><li>接口聚合，请求合并：微信的接口请求，并发是10个，websocket是5个，可以通过接口聚合，减少请求次数</li></ol><h2 id="图片懒加载优化" tabindex="-1">图片懒加载优化 <a class="header-anchor" href="#图片懒加载优化" aria-label="Permalink to &quot;图片懒加载优化&quot;">​</a></h2><h3 id="什么是图片懒加载" tabindex="-1">什么是图片懒加载 <a class="header-anchor" href="#什么是图片懒加载" aria-label="Permalink to &quot;什么是图片懒加载&quot;">​</a></h3><p>图片懒加载是指延迟加载图片，当用户滚动到可视区域时，再去加载图片，这样可以减少页面的http请求，提升页面加载速度，提升用户体验</p><h3 id="方案1-getboundingclientrect" tabindex="-1">方案1(getBoundingClientRect) <a class="header-anchor" href="#方案1-getboundingclientrect" aria-label="Permalink to &quot;方案1(getBoundingClientRect)&quot;">​</a></h3><ol><li>在img标签上添加data-src属性，值为图片的真实地址</li><li>监听scroll事件，判断图片是否进入可视区域</li><li>Element.getBoundingClientRect()判断目标元素与视口的交叉状态</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">lazyload</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">imgs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">querySelectorAll</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">img[data-src]</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">viewHeight</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">documentElement</span><span style="color:#666666;">.</span><span style="color:#BD976A;">clientHeight</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">Array</span><span style="color:#666666;">.</span><span style="color:#80A665;">from</span><span style="color:#666666;">(</span><span style="color:#BD976A;">imgs</span><span style="color:#666666;">).</span><span style="color:#80A665;">forEach</span><span style="color:#666666;">(</span><span style="color:#BD976A;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">rect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#80A665;">getBoundingClientRect</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">rect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">bottom</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">rect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">top</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">viewHeight</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">!function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Image</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">dataset</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#80A665;">onload</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">dataset</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#80A665;">removeAttribute</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">data-src</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">lazyload</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">imgs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">querySelectorAll</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">img[data-src]</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">viewHeight</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">documentElement</span><span style="color:#999999;">.</span><span style="color:#B07D48;">clientHeight</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">Array</span><span style="color:#999999;">.</span><span style="color:#59873A;">from</span><span style="color:#999999;">(</span><span style="color:#B07D48;">imgs</span><span style="color:#999999;">).</span><span style="color:#59873A;">forEach</span><span style="color:#999999;">(</span><span style="color:#B07D48;">img</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">rect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#59873A;">getBoundingClientRect</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">rect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">bottom</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">rect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">top</span><span style="color:#393A34;"> </span><span style="color:#999999;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">viewHeight</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">!function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Image</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">dataset</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#59873A;">onload</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">dataset</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#59873A;">removeAttribute</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">data-src</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}()</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="方案2-intersectionobserver" tabindex="-1">方案2(IntersectionObserver) <a class="header-anchor" href="#方案2-intersectionobserver" aria-label="Permalink to &quot;方案2(IntersectionObserver)&quot;">​</a></h3><ol><li>在img标签上添加data-src属性，值为图片的真实地址</li><li>使用IntersectionObserver监听img标签，当img标签进入可视区域时，加载图片</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">lazyload</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">imgs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">querySelectorAll</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">img[data-src]</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">observer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">IntersectionObserver</span><span style="color:#666666;">(</span><span style="color:#BD976A;">changes</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">changes</span><span style="color:#666666;">.</span><span style="color:#80A665;">forEach</span><span style="color:#666666;">(</span><span style="color:#BD976A;">change</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">change</span><span style="color:#666666;">.</span><span style="color:#BD976A;">target</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">dataset</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span></span>
<span class="line"><span style="color:#666666;">       </span><span style="color:#758575DD;">// intersectionRatio为目标元素与视口的交叉比例，isIntersecting为目标元素是否与视口交叉</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">change</span><span style="color:#666666;">.</span><span style="color:#BD976A;">intersectionRatio</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">change</span><span style="color:#666666;">.</span><span style="color:#BD976A;">isIntersecting</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">observer</span><span style="color:#666666;">.</span><span style="color:#80A665;">unobserve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">img</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">Array</span><span style="color:#666666;">.</span><span style="color:#80A665;">from</span><span style="color:#666666;">(</span><span style="color:#BD976A;">imgs</span><span style="color:#666666;">).</span><span style="color:#80A665;">forEach</span><span style="color:#666666;">(</span><span style="color:#BD976A;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">observer</span><span style="color:#666666;">.</span><span style="color:#80A665;">observe</span><span style="color:#666666;">(</span><span style="color:#BD976A;">img</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">lazyload</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">imgs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">querySelectorAll</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">img[data-src]</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">observer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">IntersectionObserver</span><span style="color:#999999;">(</span><span style="color:#B07D48;">changes</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">changes</span><span style="color:#999999;">.</span><span style="color:#59873A;">forEach</span><span style="color:#999999;">(</span><span style="color:#B07D48;">change</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">change</span><span style="color:#999999;">.</span><span style="color:#B07D48;">target</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">dataset</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span></span>
<span class="line"><span style="color:#999999;">       </span><span style="color:#A0ADA0;">// intersectionRatio为目标元素与视口的交叉比例，isIntersecting为目标元素是否与视口交叉</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">change</span><span style="color:#999999;">.</span><span style="color:#B07D48;">intersectionRatio</span><span style="color:#393A34;"> </span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">change</span><span style="color:#999999;">.</span><span style="color:#B07D48;">isIntersecting</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">observer</span><span style="color:#999999;">.</span><span style="color:#59873A;">unobserve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">img</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">Array</span><span style="color:#999999;">.</span><span style="color:#59873A;">from</span><span style="color:#999999;">(</span><span style="color:#B07D48;">imgs</span><span style="color:#999999;">).</span><span style="color:#59873A;">forEach</span><span style="color:#999999;">(</span><span style="color:#B07D48;">img</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">observer</span><span style="color:#999999;">.</span><span style="color:#59873A;">observe</span><span style="color:#999999;">(</span><span style="color:#B07D48;">img</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="方案3-img标签loading属性" tabindex="-1">方案3(img标签loading属性) <a class="header-anchor" href="#方案3-img标签loading属性" aria-label="Permalink to &quot;方案3(img标签loading属性)&quot;">​</a></h3><p><a href="https://caniuse.com/loading-lazy-attr" target="_blank" rel="noreferrer">支持度不高，不推荐使用</a></p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">http://www.xxx.com/target.jpg</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">decoding</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">async</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">loading</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">lazy</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">/&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">img</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">http://www.xxx.com/target.jpg</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">decoding</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">async</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">loading</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">lazy</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#999999;">/&gt;</span></span></code></pre></div><h2 id="浏览器本地存储" tabindex="-1">浏览器本地存储 <a class="header-anchor" href="#浏览器本地存储" aria-label="Permalink to &quot;浏览器本地存储&quot;">​</a></h2><h3 id="cookie" tabindex="-1">cookie <a class="header-anchor" href="#cookie" aria-label="Permalink to &quot;cookie&quot;">​</a></h3><ol><li>本身用于客户端和服务端通信</li><li>本身有大小限制，每个域名下最多只能有20个cookie，每个cookie的大小不能超过4KB</li><li>本身有安全性问题，cookie中的数据可以通过document.cookie获取，容易被攻击者获取</li><li>作用域：cookie的作用域是由cookie的path属性决定的，如果path为/，则在整个域名下都有效，如果path为/foo，则在/foo路径下有效，如果path为/bar，则在/bar路径下有效</li><li>失效：cookie的失效时间由expires属性决定，如果没有设置expires属性，则cookie的生命周期为浏览器会话期间，即关闭浏览器后失效，如果设置了expires属性，则cookie的生命周期为expires属性值，即在expires属性值到达后失效，如果设置了max-age属性，则cookie的生命周期为max-age属性值，即在max-age属性值到达后失效</li></ol><h3 id="localstorage" tabindex="-1">localStorage <a class="header-anchor" href="#localstorage" aria-label="Permalink to &quot;localStorage&quot;">​</a></h3><ol><li>本身用于存储本地数据，不会随着http请求发送到服务端</li><li>本身有大小限制，不同浏览器不同，一般为5M</li><li>本身有安全性问题，容易被攻击者获取</li><li>作用域：localStorage的作用域是整个域名下都有效</li><li>失效：localStorage的失效时间由setItem方法的第二个参数决定，如果没有设置第二个参数，则localStorage的生命周期为永久，如果设置了第二个参数，则localStorage的生命周期为第二个参数值，即在第二个参数值到达后失效</li></ol><h3 id="sessionstorage" tabindex="-1">sessionStorage <a class="header-anchor" href="#sessionstorage" aria-label="Permalink to &quot;sessionStorage&quot;">​</a></h3><ol><li>本身用于存储本地数据，不会随着http请求发送到服务端</li><li>本身有大小限制，不同浏览器不同，一般为5M</li><li>本身有安全性问题，容易被攻击者获取</li><li>作用域：sessionStorage的作用域是整个域名下都有效</li><li>失效：sessionStorage的失效时间为会话期间，即关闭浏览器后失效，如果是同一个浏览器的不同标签页，sessionStorage是共享的，如果是不同浏览器的不同标签页，sessionStorage是不共享的</li></ol><h3 id="indexeddb" tabindex="-1">indexedDB <a class="header-anchor" href="#indexeddb" aria-label="Permalink to &quot;indexedDB&quot;">​</a></h3><p>IndexedDB是一种基于键值对的对象存储数据库。它提供了一个结构化的、事务性的存储机制，用于存储大量的数据，并支持高效的索引查询。IndexedDB是一个异步的API，可以在浏览器中创建和管理数据库，存储和检索数据，并通过索引进行高效的查询。它适用于处理较大数据集和复杂查询的场景，例如离线应用、缓存数据、数据同步等。</p><ol><li>本身用于存储本地数据，不会随着http请求发送到服务端</li><li>本身没有大小限制</li><li>本身有安全性问题，容易被攻击者获取</li><li>作用域：indexedDB的作用域是整个域名下都有效</li><li>失效：indexedDB的失效时间由开发者决定</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// cookie</span></span>
<span class="line"><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">cookie</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name=张三</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">cookie</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// localStorage</span></span>
<span class="line"><span style="color:#BD976A;">localStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">setItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">张三</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">localStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">getItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">localStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">removeItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">localStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">clear</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// sessionStorage</span></span>
<span class="line"><span style="color:#BD976A;">sessionStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">setItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">张三</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">sessionStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">getItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">sessionStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">removeItem</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">sessionStorage</span><span style="color:#666666;">.</span><span style="color:#80A665;">clear</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// indexedDB</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">request</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">indexedDB</span><span style="color:#666666;">.</span><span style="color:#80A665;">open</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">test</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onupgradeneeded</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">db</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">event</span><span style="color:#666666;">.</span><span style="color:#BD976A;">target</span><span style="color:#666666;">.</span><span style="color:#BD976A;">result</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">objectStore</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">db</span><span style="color:#666666;">.</span><span style="color:#80A665;">createObjectStore</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">person</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">keyPath</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">id</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">objectStore</span><span style="color:#666666;">.</span><span style="color:#80A665;">createIndex</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">name</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">unique</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">objectStore</span><span style="color:#666666;">.</span><span style="color:#80A665;">createIndex</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">email</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">email</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">unique</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onsuccess</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">db</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">event</span><span style="color:#666666;">.</span><span style="color:#BD976A;">target</span><span style="color:#666666;">.</span><span style="color:#BD976A;">result</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">transaction</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">db</span><span style="color:#666666;">.</span><span style="color:#80A665;">transaction</span><span style="color:#666666;">([</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">person</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">],</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">readwrite</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">objectStore</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">transaction</span><span style="color:#666666;">.</span><span style="color:#80A665;">objectStore</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">person</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">person</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">id</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">张三</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">email</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#C98A7D;">  </span><span style="color:#FDAEB7;font-style:italic;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">request</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">objectStore</span><span style="color:#666666;">.</span><span style="color:#80A665;">add</span><span style="color:#666666;">(</span><span style="color:#BD976A;">person</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onsuccess</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">数据写入成功</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onerror</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">数据写入失败</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onerror</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">数据库打开失败</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// cookie</span></span>
<span class="line"><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">cookie</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name=张三</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">cookie</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// localStorage</span></span>
<span class="line"><span style="color:#B07D48;">localStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">setItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">张三</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">localStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">getItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">localStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">removeItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">localStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">clear</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// sessionStorage</span></span>
<span class="line"><span style="color:#B07D48;">sessionStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">setItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">张三</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">sessionStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">getItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">sessionStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">removeItem</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">sessionStorage</span><span style="color:#999999;">.</span><span style="color:#59873A;">clear</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// indexedDB</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">request</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">indexedDB</span><span style="color:#999999;">.</span><span style="color:#59873A;">open</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">test</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onupgradeneeded</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">db</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">event</span><span style="color:#999999;">.</span><span style="color:#B07D48;">target</span><span style="color:#999999;">.</span><span style="color:#B07D48;">result</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">objectStore</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">db</span><span style="color:#999999;">.</span><span style="color:#59873A;">createObjectStore</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">person</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#998418;">keyPath</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">id</span><span style="color:#B5695999;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">objectStore</span><span style="color:#999999;">.</span><span style="color:#59873A;">createIndex</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">name</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#998418;">unique</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">objectStore</span><span style="color:#999999;">.</span><span style="color:#59873A;">createIndex</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">email</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">email</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#998418;">unique</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onsuccess</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">db</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">event</span><span style="color:#999999;">.</span><span style="color:#B07D48;">target</span><span style="color:#999999;">.</span><span style="color:#B07D48;">result</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">transaction</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">db</span><span style="color:#999999;">.</span><span style="color:#59873A;">transaction</span><span style="color:#999999;">([</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">person</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">],</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">readwrite</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">objectStore</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">transaction</span><span style="color:#999999;">.</span><span style="color:#59873A;">objectStore</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">person</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">person</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">id</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">张三</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">email</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#B56959;">  </span><span style="color:#B31D28;font-style:italic;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">request</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">objectStore</span><span style="color:#999999;">.</span><span style="color:#59873A;">add</span><span style="color:#999999;">(</span><span style="color:#B07D48;">person</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onsuccess</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">数据写入成功</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onerror</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">数据写入失败</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onerror</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">数据库打开失败</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>还有一种存储技术是WebSQL，这是一种基于关系型数据库的客户端存储技术。它基于SQL语言和关系型数据库的概念，提供了一种简单的方式来操作和管理本地数据。WebSQL使用SQLite数据库引擎，并提供了一个SQL接口，用于创建、查询、更新和删除数据。它是一个同步的API，可以在浏览器中直接执行SQL语句，对数据进行操作。WebSQL在一些早期的浏览器中得到支持，但目前已被废弃，并不再是Web标准的一部分。</p></div><h2 id="浏览器同源策略及跨域方案" tabindex="-1">浏览器同源策略及跨域方案 <a class="header-anchor" href="#浏览器同源策略及跨域方案" aria-label="Permalink to &quot;浏览器同源策略及跨域方案&quot;">​</a></h2><h3 id="同源策略" tabindex="-1">同源策略 <a class="header-anchor" href="#同源策略" aria-label="Permalink to &quot;同源策略&quot;">​</a></h3><p>同源策略是浏览器的一种安全策略，它用于限制一个origin的文档或者它加载的脚本如何能与另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的关键的安全机制。</p><p>如何判断两个url是否同源？</p><ol><li>协议相同</li><li>域名相同</li><li>端口相同</li></ol><p>同源策略的限制内容包括：</p><ol><li>Cookie、LocalStorage 和 IndexDB 无法读取</li><li>DOM 和 Js对象无法获得</li><li>AJAX 请求不能发送</li></ol><p>同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的关键的安全机制。</p><h3 id="跨域" tabindex="-1">跨域 <a class="header-anchor" href="#跨域" aria-label="Permalink to &quot;跨域&quot;">​</a></h3><p>跨域是指浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对JavaScript施加的安全限制。</p><ol><li>jsonp：利用script标签没有跨域限制的漏洞实现。缺点只支持GET请求。</li><li>CORS设置Access-Control-Allow-Origin：指定可访问资源的域名。</li><li>Websocker请求跨域：是HTML5的一个持久化协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。</li><li>代理转发：反向代理（Nginx、Node），正向代理（VPN）。</li><li>页面跨域(postMessage、改变iframe的location、window.name、window.open、document.domain)。</li></ol><h2 id="异常处理" tabindex="-1">异常处理 <a class="header-anchor" href="#异常处理" aria-label="Permalink to &quot;异常处理&quot;">​</a></h2><h3 id="window-onerror" tabindex="-1">window.onerror <a class="header-anchor" href="#window-onerror" aria-label="Permalink to &quot;window.onerror&quot;">​</a></h3><p>特点：</p><ul><li>语法错误，静态资源，接口异常无法捕获</li><li>只有在返回true的时候，异常才不会向上抛出</li><li>最好写在所有JS脚本的前面</li><li>捕获预料之外的错误</li><li>配合window.addEventListener</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">error</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">error</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">);</span></span></code></pre></div><h3 id="try-catch" tabindex="-1">try-catch <a class="header-anchor" href="#try-catch" aria-label="Permalink to &quot;try-catch&quot;">​</a></h3><p>只能捕获同步异常，不能捕获异步异常。</p><p>用来在可预见的代码中捕获异常，而不是用来处理意料之外的异常。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">try</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Error</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">error</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1000</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">catch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">try</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Error</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">error</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1000</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">catch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="promise-catch" tabindex="-1">Promise catch <a class="header-anchor" href="#promise-catch" aria-label="Permalink to &quot;Promise catch&quot;">​</a></h3><p>promise中的cache可以捕获异步error，不可漏写</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">((</span><span style="color:#BD976A;">resolve</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">reject</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">error</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1000</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}).</span><span style="color:#80A665;">catch</span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">((</span><span style="color:#B07D48;">resolve</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">reject</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">error</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1000</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}).</span><span style="color:#59873A;">catch</span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div><p>全局增加unhandledrejection事件，可以捕获未被catch的异常</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">unhandledrejection</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">unhandledrejection</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div><p>去掉控制台的异常提示</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">error</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">error</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">);</span></span></code></pre></div><h3 id="iframe异常" tabindex="-1">iframe异常 <a class="header-anchor" href="#iframe异常" aria-label="Permalink to &quot;iframe异常&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">iframe</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">http://www.baidu.com</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onload</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#80A665;">onloadHandler</span><span style="color:#666666;">()</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onerror</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#80A665;">onerrorHandler</span><span style="color:#666666;">()</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#666666;">&gt;&lt;/</span><span style="color:#4D9375;">iframe</span><span style="color:#666666;">&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">iframe</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">http://www.baidu.com</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onload</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#59873A;">onloadHandler</span><span style="color:#999999;">()</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onerror</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#59873A;">onerrorHandler</span><span style="color:#999999;">()</span><span style="color:#B5695999;">&quot;</span><span style="color:#999999;">&gt;&lt;/</span><span style="color:#1E754F;">iframe</span><span style="color:#999999;">&gt;</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#BD976A;">frames</span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#666666;">].</span><span style="color:#80A665;">oneerror</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">捕获到异常</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#B07D48;">frames</span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#999999;">].</span><span style="color:#59873A;">oneerror</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">捕获到异常</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="script-error异常" tabindex="-1">script error异常 <a class="header-anchor" href="#script-error异常" aria-label="Permalink to &quot;script error异常&quot;">​</a></h3><p>如果是跨域问题，可以通过script标签的crossorigin属性来解决。</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">script</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">http://www.baidu.com</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">crossorigin</span><span style="color:#666666;">&gt;&lt;/</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">script</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">http://www.baidu.com</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">crossorigin</span><span style="color:#999999;">&gt;&lt;/</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span></span></code></pre></div><p>动态添加js脚本(服务器端响应头里还需要设置Access-Control-Allow-Origin)</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">script</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">createElement</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">script</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#BD976A;">script</span><span style="color:#666666;">.</span><span style="color:#BD976A;">crossOrigin</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">anonymous</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#BD976A;">script</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">body</span><span style="color:#666666;">.</span><span style="color:#80A665;">appendChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">script</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">script</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">createElement</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">script</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#B07D48;">script</span><span style="color:#999999;">.</span><span style="color:#B07D48;">crossOrigin</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">anonymous</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#B07D48;">script</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">body</span><span style="color:#999999;">.</span><span style="color:#59873A;">appendChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">script</span><span style="color:#999999;">);</span></span></code></pre></div><p>改写EventTarget</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">originAddEventListener</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">EventTarget</span><span style="color:#666666;">.</span><span style="color:#B8A965;">prototype</span><span style="color:#666666;">.</span><span style="color:#BD976A;">addEventListener</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#B8A965;">EventTarget</span><span style="color:#666666;">.</span><span style="color:#B8A965;">prototype</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">listener</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">options</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">wrappedListener</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(...</span><span style="color:#BD976A;">args</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">try</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">listener</span><span style="color:#666666;">.</span><span style="color:#80A665;">apply</span><span style="color:#666666;">(</span><span style="color:#C99076;">this</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">catch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">err</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">originAddEventListener</span><span style="color:#666666;">.</span><span style="color:#80A665;">call</span><span style="color:#666666;">(</span><span style="color:#C99076;">this</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">wrappedListener</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">options</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">originAddEventListener</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#998418;">EventTarget</span><span style="color:#999999;">.</span><span style="color:#998418;">prototype</span><span style="color:#999999;">.</span><span style="color:#B07D48;">addEventListener</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#998418;">EventTarget</span><span style="color:#999999;">.</span><span style="color:#998418;">prototype</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">listener</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">options</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">wrappedListener</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(...</span><span style="color:#B07D48;">args</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">try</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">listener</span><span style="color:#999999;">.</span><span style="color:#59873A;">apply</span><span style="color:#999999;">(</span><span style="color:#A65E2B;">this</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">catch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">err</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">originAddEventListener</span><span style="color:#999999;">.</span><span style="color:#59873A;">call</span><span style="color:#999999;">(</span><span style="color:#A65E2B;">this</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">wrappedListener</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">options</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="vue-异常" tabindex="-1">vue 异常 <a class="header-anchor" href="#vue-异常" aria-label="Permalink to &quot;vue 异常&quot;">​</a></h3><p>vue.config.errorHandler</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">Vue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">errorHandler</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vm</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">info</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">={}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">Vue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">errorHandler</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vm</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">info</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">={}</span></span></code></pre></div><h3 id="react-异常" tabindex="-1">react 异常 <a class="header-anchor" href="#react-异常" aria-label="Permalink to &quot;react 异常&quot;">​</a></h3><p>react 16版本之后增加了componentDidCatch生命周期函数，用来捕获子组件树的异常。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">class</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA994;">ErrorBoundary</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">extends</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA994;">React</span><span style="color:#666666;">.</span><span style="color:#80A665;">Component</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">constructor</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">super</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">state</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">hasError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">static</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getDerivedStateFromError</span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">hasError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">componentDidCatch</span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">errorInfo</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">errorInfo</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">render</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">state</span><span style="color:#666666;">.</span><span style="color:#BD976A;">hasError</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">Something went wrong.</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">props</span><span style="color:#666666;">.</span><span style="color:#BD976A;">children</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">class</span><span style="color:#393A34;"> </span><span style="color:#2E8F82;">ErrorBoundary</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">extends</span><span style="color:#393A34;"> </span><span style="color:#2E8F82;">React</span><span style="color:#999999;">.</span><span style="color:#59873A;">Component</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">constructor</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">super</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">state</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#998418;">hasError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#393A34;"> </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">static</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getDerivedStateFromError</span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#998418;">hasError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#393A34;"> </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">componentDidCatch</span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">errorInfo</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">errorInfo</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">render</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">state</span><span style="color:#999999;">.</span><span style="color:#B07D48;">hasError</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">Something went wrong.</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">props</span><span style="color:#999999;">.</span><span style="color:#B07D48;">children</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h2 id="前端监控" tabindex="-1">前端监控 <a class="header-anchor" href="#前端监控" aria-label="Permalink to &quot;前端监控&quot;">​</a></h2><p>前端监控分三大类：用户行为、性能监控、异常监控。</p><h3 id="前端监控的方法" tabindex="-1">前端监控的方法 <a class="header-anchor" href="#前端监控的方法" aria-label="Permalink to &quot;前端监控的方法&quot;">​</a></h3><p>手动埋点：百度统计、谷歌统计、友盟统计</p><p>可视化埋点：可视化埋点工具，如神策、GrowingIO</p><p>无埋点：通过监听用户行为，自动上报数据，如用户点击、页面加载、ajax请求等。</p><h3 id="崩溃监控-性能监控类" tabindex="-1">崩溃监控（性能监控类） <a class="header-anchor" href="#崩溃监控-性能监控类" aria-label="Permalink to &quot;崩溃监控（性能监控类）&quot;">​</a></h3><p>window对象的load和beforeunload事件实现了网页崩溃的监控。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// 监听页面加载完成事件</span></span>
<span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">load</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// 页面加载完成，执行初始化操作</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">页面加载完成</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// 注册 beforeunload 事件</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">beforeunload</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 页面即将卸载，执行清理操作</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">页面即将卸载</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 判断是否发生网页崩溃</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">event</span><span style="color:#666666;">.</span><span style="color:#BD976A;">currentTarget</span><span style="color:#666666;">.</span><span style="color:#BD976A;">performance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">navigationType</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// 网页崩溃事件处理逻辑</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">网页崩溃</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 可以在此处执行一些清理操作，如释放资源、保存数据等</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// ...</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">});</span></span>
<span class="line"><span style="color:#666666;">});</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// 监听页面加载完成事件</span></span>
<span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">load</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// 页面加载完成，执行初始化操作</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">页面加载完成</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// 注册 beforeunload 事件</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">beforeunload</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 页面即将卸载，执行清理操作</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">页面即将卸载</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 判断是否发生网页崩溃</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">event</span><span style="color:#999999;">.</span><span style="color:#B07D48;">currentTarget</span><span style="color:#999999;">.</span><span style="color:#B07D48;">performance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">navigationType</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// 网页崩溃事件处理逻辑</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">网页崩溃</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 可以在此处执行一些清理操作，如释放资源、保存数据等</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// ...</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">});</span></span>
<span class="line"><span style="color:#999999;">});</span></span></code></pre></div><p>使用Service Worker来实现网页崩溃的监控</p><p>有自己独立的工作线程，与网页区分开，网页崩溃后，Service Worker 一般情况下不会崩溃；Service Worker生命周期一般要比网页还要长，可以用来监控网页的状态；网页可以通过navigator.serviceWorker.controller.postMessage API 向掌管自己的SW发送消息。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// sw.js</span></span>
<span class="line"><span style="color:#BD976A;">self</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">message</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">event</span><span style="color:#666666;">.</span><span style="color:#BD976A;">data</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">crash</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">fetch</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">https://httpbin.org/status/500</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// index.js</span></span>
<span class="line"><span style="color:#BD976A;">navigator</span><span style="color:#666666;">.</span><span style="color:#BD976A;">serviceWorker</span><span style="color:#666666;">.</span><span style="color:#BD976A;">controller</span><span style="color:#666666;">.</span><span style="color:#80A665;">postMessage</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">crash</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// sw.js</span></span>
<span class="line"><span style="color:#B07D48;">self</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">message</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">event</span><span style="color:#999999;">.</span><span style="color:#B07D48;">data</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">crash</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">fetch</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">https://httpbin.org/status/500</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// index.js</span></span>
<span class="line"><span style="color:#B07D48;">navigator</span><span style="color:#999999;">.</span><span style="color:#B07D48;">serviceWorker</span><span style="color:#999999;">.</span><span style="color:#B07D48;">controller</span><span style="color:#999999;">.</span><span style="color:#59873A;">postMessage</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">crash</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">);</span></span></code></pre></div><h3 id="卡顿监控-性能监控类" tabindex="-1">卡顿监控（性能监控类） <a class="header-anchor" href="#卡顿监控-性能监控类" aria-label="Permalink to &quot;卡顿监控（性能监控类）&quot;">​</a></h3><p>performance.now</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">t0</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">performance</span><span style="color:#666666;">.</span><span style="color:#80A665;">now</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#758575DD;">// 执行一些操作</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">t1</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">performance</span><span style="color:#666666;">.</span><span style="color:#80A665;">now</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">\`</span><span style="color:#C98A7D;">操作耗时</span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">t1 </span><span style="color:#CB7676;">-</span><span style="color:#C98A7D;"> t0</span><span style="color:#666666;">}</span><span style="color:#C98A7D;">毫秒</span><span style="color:#C98A7D99;">\`</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">t0</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">performance</span><span style="color:#999999;">.</span><span style="color:#59873A;">now</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#A0ADA0;">// 执行一些操作</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">t1</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">performance</span><span style="color:#999999;">.</span><span style="color:#59873A;">now</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">\`</span><span style="color:#B56959;">操作耗时</span><span style="color:#999999;">\${</span><span style="color:#B56959;">t1 </span><span style="color:#AB5959;">-</span><span style="color:#B56959;"> t0</span><span style="color:#999999;">}</span><span style="color:#B56959;">毫秒</span><span style="color:#B5695999;">\`</span><span style="color:#999999;">);</span></span></code></pre></div><p>通过requestAnimationFrame来实现卡顿监控，我们可以定义一些边界值，比如连续出现3个低于20的 FPS 即可认为网页存在卡顿</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">performance</span><span style="color:#666666;">.</span><span style="color:#80A665;">now</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">loop</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">now</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">performance</span><span style="color:#666666;">.</span><span style="color:#80A665;">now</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">\`</span><span style="color:#C98A7D;">本帧与上一帧的间隔时间为</span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">now </span><span style="color:#CB7676;">-</span><span style="color:#C98A7D;"> lastTime</span><span style="color:#666666;">}</span><span style="color:#C98A7D;">毫秒</span><span style="color:#C98A7D99;">\`</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">lastTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">now</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">requestAnimationFrame</span><span style="color:#666666;">(</span><span style="color:#BD976A;">loop</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#80A665;">requestAnimationFrame</span><span style="color:#666666;">(</span><span style="color:#BD976A;">loop</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">performance</span><span style="color:#999999;">.</span><span style="color:#59873A;">now</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">loop</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">now</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">performance</span><span style="color:#999999;">.</span><span style="color:#59873A;">now</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">\`</span><span style="color:#B56959;">本帧与上一帧的间隔时间为</span><span style="color:#999999;">\${</span><span style="color:#B56959;">now </span><span style="color:#AB5959;">-</span><span style="color:#B56959;"> lastTime</span><span style="color:#999999;">}</span><span style="color:#B56959;">毫秒</span><span style="color:#B5695999;">\`</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">lastTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">now</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">requestAnimationFrame</span><span style="color:#999999;">(</span><span style="color:#B07D48;">loop</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#59873A;">requestAnimationFrame</span><span style="color:#999999;">(</span><span style="color:#B07D48;">loop</span><span style="color:#999999;">);</span></span></code></pre></div><h3 id="埋点-git上报" tabindex="-1">埋点：GIT上报 <a class="header-anchor" href="#埋点-git上报" aria-label="Permalink to &quot;埋点：GIT上报&quot;">​</a></h3><ol><li>防止跨域，不受限于协议、域名、端口</li><li>防止阻塞页面加载，影响用户体验</li><li>通过Image对象上报，不会造成页面跳转</li><li>相比较PNG/JPG，GIT请求更小，上报更快(最小的GIF图片只有43个字节)</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">report</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Image</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">img</span><span style="color:#666666;">.</span><span style="color:#BD976A;">src</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">http://www.baidu.com/report?</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">data</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">report</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">img</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Image</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">img</span><span style="color:#999999;">.</span><span style="color:#B07D48;">src</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">http://www.baidu.com/report?</span><span style="color:#B5695999;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">data</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h4 id="埋点上报降低服务器压力" tabindex="-1">埋点上报降低服务器压力 <a class="header-anchor" href="#埋点上报降低服务器压力" aria-label="Permalink to &quot;埋点上报降低服务器压力&quot;">​</a></h4><p>可以设置采集率（随机数或者用户特征）</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">Reporter</span><span style="color:#666666;">.</span><span style="color:#80A665;">send</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// 只采集 30%</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Math</span><span style="color:#666666;">.</span><span style="color:#80A665;">random</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0.3</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">send</span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;">      </span><span style="color:#758575DD;">// 上报错误信息</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">Reporter</span><span style="color:#999999;">.</span><span style="color:#59873A;">send</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// 只采集 30%</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Math</span><span style="color:#999999;">.</span><span style="color:#59873A;">random</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0.3</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">send</span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span><span style="color:#393A34;">      </span><span style="color:#A0ADA0;">// 上报错误信息</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><h3 id="第三方监控" tabindex="-1">第三方监控 <a class="header-anchor" href="#第三方监控" aria-label="Permalink to &quot;第三方监控&quot;">​</a></h3><p>sentry</p><h3 id="线上代码排查" tabindex="-1">线上代码排查 <a class="header-anchor" href="#线上代码排查" aria-label="Permalink to &quot;线上代码排查&quot;">​</a></h3><p>source-map</p><h2 id="前端页面渲染的几种方式" tabindex="-1">前端页面渲染的几种方式 <a class="header-anchor" href="#前端页面渲染的几种方式" aria-label="Permalink to &quot;前端页面渲染的几种方式&quot;">​</a></h2><h3 id="客户端渲染csr-croswer-side-render" tabindex="-1">客户端渲染CSR(Croswer Side Render) <a class="header-anchor" href="#客户端渲染csr-croswer-side-render" aria-label="Permalink to &quot;客户端渲染CSR(Croswer Side Render)&quot;">​</a></h3><p>框架</p><ol><li>react</li><li>vue</li><li>angular</li></ol><p>优点</p><ol><li>服务器响应速度快</li><li>支持页面交互、适用于单页应用</li></ol><p>缺点</p><ol><li>在js得到渲染之前，页面没有内容，出现页面白屏</li><li>页面渲染代码在js中，爬虫不能解读，seo引擎不够友好</li></ol><h3 id="静态页面生成ssg-static-site-generation" tabindex="-1">静态页面生成SSG(Static Site Generation) <a class="header-anchor" href="#静态页面生成ssg-static-site-generation" aria-label="Permalink to &quot;静态页面生成SSG(Static Site Generation)&quot;">​</a></h3><p>优点</p><ol><li>seo</li><li>html包括渲染的dom，和首屏加载速度快</li></ol><p>缺点</p><ol><li>适合静态页面网站，不支持页面交互</li><li>构建过程中没有window,document等，存在库的兼容问题</li></ol><h3 id="服务端渲染ssr-server-side-render" tabindex="-1">服务端渲染SSR(Server Side Render) <a class="header-anchor" href="#服务端渲染ssr-server-side-render" aria-label="Permalink to &quot;服务端渲染SSR(Server Side Render)&quot;">​</a></h3><p>优点</p><ol><li>服务器响应速度快</li><li>支持页面交互、适用于单页应用</li><li>html包括渲染的dom，和首屏加载速度快</li><li>支持seo</li></ol><p>缺点</p><ol><li>服务器压力大</li><li>代码复杂度高</li><li>部署成本高，维护成本高</li><li>服务器环境中没有window,document等，存在库的兼容问题</li></ol><p>框架</p><ol><li>next.js</li><li>nuxt.js</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>使用预渲染之前，首先要考虑是否真的需要它，如果初始加载时的额外几百毫秒并不会对应用产生影响，这种情况下去使用预选染将是一个小题大作之举。</p><p>首屏加载时间是绝对关键的指标，在这种情况下，如果是静态页面渲染可采用SSG的方式，如果需要页面交互则采取SSR的方式。</p><p>静态页面、需要SEO流量的项目、以及用户增长型项目，如：博客、活动页面、app官网等，适用于预渲染的方式。</p><p>大部分中后台项目都更加适用于客户端渲染方式。</p></div>`,241)]))}const B=n(o,[["render",e]]);export{D as __pageData,B as default};
